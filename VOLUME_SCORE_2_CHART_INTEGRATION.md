# Volume Score 2 å›¾è¡¨é›†æˆè¯´æ˜

## æ¦‚è¿°

å·²æˆåŠŸå°† `market_volume_score_minute` è¡¨çš„æ•°æ®é›†æˆåˆ° TradingView å›¾è¡¨é¡µé¢ä¸­ï¼Œç”¨æˆ·å¯ä»¥å®æ—¶æŸ¥çœ‹å¸‚åœºæ•´ä½“çš„ Volume Score 2 æŒ‡æ ‡ã€‚

## å®ç°å†…å®¹

### 1. åç«¯ API æ¥å£ (server.js)

æ–°å¢ä¸¤ä¸ª API æ¥å£ï¼š

#### `/market/volume_score/latest`
è·å–æœ€æ–°çš„ market volume score è®°å½•

**è¯·æ±‚ç¤ºä¾‹:**
```
GET /market/volume_score/latest
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "data": {
    "ts_minute": 1729670400000,
    "total_volume_ma1": 12345678.90,
    "total_volume_ma2": 10234567.89,
    "market_volume_score_2": 1.2063,
    "symbols_count": 523,
    "created_at": "2025-10-23T14:00:00.000Z"
  }
}
```

#### `/market/volume_score/history`
è·å–å†å² market volume score æ•°æ®

**è¯·æ±‚å‚æ•°:**
- `from`: èµ·å§‹æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
- `to`: ç»“æŸæ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
- `limit`: æœ€å¤§è¿”å›æ•°é‡ï¼ˆé»˜è®¤ 1000ï¼‰

**è¯·æ±‚ç¤ºä¾‹:**
```
GET /market/volume_score/history?from=1729584000000&to=1729670400000&limit=1000
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "data": [
    {
      "ts_minute": 1729584060000,
      "total_volume_ma1": 12345678.90,
      "total_volume_ma2": 10234567.89,
      "market_volume_score_2": 1.2063,
      "symbols_count": 523,
      "created_at": "2025-10-23T00:01:00.000Z"
    },
    ...
  ]
}
```

### 2. å‰ç«¯å›¾è¡¨é›†æˆ (chart_tradingview.html)

#### æ–°å¢ç»Ÿè®¡å¡ç‰‡

åœ¨é¡µé¢é¡¶éƒ¨çš„ç»Ÿè®¡åŒºåŸŸæ–°å¢äº† "å½“å‰ Volume Score 2" å¡ç‰‡ï¼š

```html
<div class="stat-card">
  <h3>å½“å‰ Volume Score 2</h3>
  <div class="value" id="currentVolumeScore2">--</div>
</div>
```

- æ˜¾ç¤ºæœ€æ–°çš„ Volume Score 2 å€¼ï¼ˆä¿ç•™ 4 ä½å°æ•°ï¼‰
- é¢œè‰²æŒ‡ç¤ºï¼š
  - ç»¿è‰²ï¼š> 1.0ï¼ˆæˆäº¤é‡æ´»è·ƒåº¦é«˜äºå¹³å‡ï¼‰
  - çº¢è‰²ï¼š< 1.0ï¼ˆæˆäº¤é‡æ´»è·ƒåº¦ä½äºå¹³å‡ï¼‰

#### æ–°å¢å›¾è¡¨

åœ¨é¡µé¢åº•éƒ¨æ–°å¢äº†ç‹¬ç«‹çš„ Volume Score 2 å›¾è¡¨ï¼š

```html
<div class="chart-container">
  <h2>Market Volume Score 2 (MA Ratio)</h2>
  <div id="volumeScore2Chart" class="chart-wrapper"></div>
</div>
```

**å›¾è¡¨ç‰¹æ€§:**
- æ©™è‰²çº¿æ¡ï¼ˆ#FF9800ï¼‰
- æ·»åŠ äº† 1.0 å‚è€ƒçº¿ï¼ˆè™šçº¿ï¼‰
- è‡ªåŠ¨è°ƒæ•´æ—¶é—´è½´
- å“åº”å¼å¸ƒå±€

#### æ•°æ®åŠ è½½æµç¨‹

```javascript
// 1. å¹¶è¡Œè¯·æ±‚ä¸‰ä¸ªæ•°æ®æº
const requests = [
  fetch(`/tradingview/history?symbol=MARKET_PRICE&...`),
  fetch(`/tradingview/history?symbol=MARKET_VOLUME&...`),
  fetch(`/market/volume_score/history?from=${fromMs}&to=${toMs}`)  // æ–°å¢
];

// 2. è½¬æ¢æ•°æ®æ ¼å¼
const volumeScore2ChartData = (volumeScore2Data || []).map(item => ({
  time: Math.floor(item.ts_minute / 1000) + TIMEZONE_OFFSET,
  value: item.market_volume_score_2
}));

// 3. æ›´æ–°å›¾è¡¨
volumeScore2Series.setData(volumeScore2ChartData);
```

## æ•°æ®è¯´æ˜

### Volume Score 2 è®¡ç®—é€»è¾‘

```
market_volume_score_2 = total_volume_ma1 / total_volume_ma2

å…¶ä¸­:
- total_volume_ma1: æ‰€æœ‰å¸‚å€¼ < 5äº¿å¸ç§çš„ MA5 æ€»å’Œ
- total_volume_ma2: æ‰€æœ‰å¸‚å€¼ < 5äº¿å¸ç§çš„ MA120 æ€»å’Œ
- MA5: æœ€è¿‘ 5 æ ¹ 5 åˆ†é’Ÿ K çº¿çš„å¹³å‡æˆäº¤é‡ï¼ˆ25 åˆ†é’Ÿï¼‰
- MA120: æœ€è¿‘ 120 æ ¹ 5 åˆ†é’Ÿ K çº¿çš„å¹³å‡æˆäº¤é‡ï¼ˆ10 å°æ—¶ï¼‰
```

### æŒ‡æ ‡å«ä¹‰

| Volume Score 2 å€¼ | å«ä¹‰ |
|------------------|------|
| > 1.5 | æˆäº¤é‡æ˜¾è‘—é«˜äºå¹³å‡æ°´å¹³ï¼Œå¸‚åœºéå¸¸æ´»è·ƒ |
| 1.0 - 1.5 | æˆäº¤é‡é«˜äºå¹³å‡æ°´å¹³ï¼Œå¸‚åœºæ´»è·ƒ |
| 0.8 - 1.0 | æˆäº¤é‡æ¥è¿‘å¹³å‡æ°´å¹³ï¼Œå¸‚åœºæ­£å¸¸ |
| < 0.8 | æˆäº¤é‡ä½äºå¹³å‡æ°´å¹³ï¼Œå¸‚åœºæ¸…æ·¡ |

## é¡µé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š Market State Monitor - TradingView Charts       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [æ—¶é—´èŒƒå›´] [åˆ†è¾¨ç‡] [æ˜¾ç¤ºåŸå§‹æ•°æ®] [å‡çº¿] [åˆ·æ–°]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚ä»·æ ¼  â”‚ â”‚æˆäº¤é‡â”‚ â”‚VS2   â”‚ â”‚æ•°æ®ç‚¹â”‚ â”‚æ›´æ–°  â”‚       â”‚
â”‚ â”‚å¾—åˆ†  â”‚ â”‚å¾—åˆ†  â”‚ â”‚      â”‚ â”‚æ•°é‡  â”‚ â”‚æ—¶é—´  â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Market Price Score (-100 ~ 100)                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚         [ä»·æ ¼å¾—åˆ†å›¾è¡¨]                           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Market Volume Score (0 ~ 100)                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚         [æˆäº¤é‡å¾—åˆ†å›¾è¡¨]                         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Market Volume Score 2 (MA Ratio)  â† æ–°å¢            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚         [Volume Score 2 å›¾è¡¨]                    â”‚ â”‚
â”‚ â”‚         æ©™è‰²çº¿æ¡ + 1.0 å‚è€ƒçº¿                     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä½¿ç”¨æ–¹æ³•

### 1. å¯åŠ¨æœåŠ¡

ç¡®ä¿ä»¥ä¸‹è¿›ç¨‹æ­£åœ¨è¿è¡Œï¼š

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
pm2 start ecosystem.config.cjs

# æˆ–å•ç‹¬å¯åŠ¨
pm2 start volume_score_calculator.js --name volume-score-calc
pm2 start server.js --name server
```

### 2. è®¿é—®é¡µé¢

```
http://localhost:8080/chart
```

### 3. æŸ¥çœ‹æ•°æ®

- **ç»Ÿè®¡å¡ç‰‡**: é¡µé¢é¡¶éƒ¨æ˜¾ç¤ºå½“å‰ Volume Score 2 å€¼
- **å›¾è¡¨**: é¡µé¢åº•éƒ¨æ˜¾ç¤ºå†å²è¶‹åŠ¿
- **æ—¶é—´èŒƒå›´**: å¯é€‰æ‹© 1å°æ—¶ã€6å°æ—¶ã€24å°æ—¶ã€3å¤©ã€7å¤©
- **è‡ªåŠ¨åˆ·æ–°**: ç‚¹å‡» "å¯ç”¨è‡ªåŠ¨åˆ·æ–°" æŒ‰é’®ï¼Œæ¯åˆ†é’Ÿè‡ªåŠ¨æ›´æ–°

## è°ƒè¯•

### æ£€æŸ¥æ•°æ®æ˜¯å¦æ­£å¸¸

```bash
# 1. æ£€æŸ¥æ•°æ®åº“æ˜¯å¦æœ‰æ•°æ®
sqlite3 data.sqlite "SELECT COUNT(*) FROM market_volume_score_minute;"

# 2. æŸ¥çœ‹æœ€æ–°è®°å½•
sqlite3 data.sqlite "SELECT * FROM market_volume_score_minute ORDER BY ts_minute DESC LIMIT 5;"

# 3. æµ‹è¯• API
curl "http://localhost:8080/market/volume_score/latest"
curl "http://localhost:8080/market/volume_score/history?limit=10"
```

### æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼ŒæŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼š

```
åŠ è½½æ•°æ®...
Price data: ok 1440 points
Volume data: ok 1440 points
Volume Score 2 data: 1440 points
âœ“ å›¾è¡¨æ›´æ–°æˆåŠŸ { showRawData: false, volumeScore2Points: 1440 }
```

## å¸¸è§é—®é¢˜

### Q1: Volume Score 2 å›¾è¡¨æ˜¾ç¤ºä¸ºç©º

**å¯èƒ½åŸå› :**
1. `volume_score_calculator.js` æœªè¿è¡Œ
2. æ•°æ®åº“ä¸­æ²¡æœ‰æ•°æ®ï¼ˆé¦–æ¬¡è¿è¡Œéœ€è¦ç­‰å¾… 1 åˆ†é’Ÿï¼‰

**è§£å†³æ–¹æ³•:**
```bash
# æ£€æŸ¥è¿›ç¨‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs volume-score-calc

# é‡å¯è¿›ç¨‹
pm2 restart volume-score-calc
```

### Q2: ç»Ÿè®¡å¡ç‰‡æ˜¾ç¤º "--"

**å¯èƒ½åŸå› :**
æ•°æ®è¿˜æœªç”Ÿæˆæˆ– API è¯·æ±‚å¤±è´¥

**è§£å†³æ–¹æ³•:**
1. ç­‰å¾… 1-2 åˆ†é’Ÿè®©æ•°æ®ç”Ÿæˆ
2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
3. æ‰‹åŠ¨åˆ·æ–°é¡µé¢

### Q3: å›¾è¡¨æ—¶é—´ä¸å¯¹

**è¯´æ˜:**
å›¾è¡¨å·²è‡ªåŠ¨è½¬æ¢ä¸ºä¸œ8åŒºæ—¶é—´ï¼ˆUTC+8ï¼‰ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒæ•´ã€‚

## ä¿®æ”¹çš„æ–‡ä»¶

1. âœ… **server.js**
   - å¯¼å…¥ `getLatestMarketVolumeScore`, `getMarketVolumeScoreHistory`
   - æ–°å¢ `/market/volume_score/latest` æ¥å£
   - æ–°å¢ `/market/volume_score/history` æ¥å£

2. âœ… **chart_tradingview.html**
   - æ–°å¢ Volume Score 2 ç»Ÿè®¡å¡ç‰‡
   - æ–°å¢ Volume Score 2 å›¾è¡¨å®¹å™¨
   - åˆå§‹åŒ–ç¬¬ä¸‰ä¸ªå›¾è¡¨
   - åŠ è½½å’Œæ˜¾ç¤º Volume Score 2 æ•°æ®
   - æ›´æ–°ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤º

## æ€§èƒ½è€ƒè™‘

- **æ•°æ®é‡**: é»˜è®¤æœ€å¤šè¿”å› 1000 æ¡è®°å½•
- **æ›´æ–°é¢‘ç‡**: æ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡
- **å¹¶è¡Œè¯·æ±‚**: ä¸‰ä¸ªæ•°æ®æºå¹¶è¡ŒåŠ è½½ï¼Œæé«˜å“åº”é€Ÿåº¦
- **å“åº”å¼**: å›¾è¡¨è‡ªåŠ¨é€‚åº”çª—å£å¤§å°

## æœªæ¥ä¼˜åŒ–

1. **æ•°æ®èšåˆ**: æ”¯æŒæŒ‰å°æ—¶/å¤©èšåˆæ˜¾ç¤º
2. **å¯¹æ¯”åˆ†æ**: æ·»åŠ å¤šä¸ªæ—¶é—´æ®µçš„å¯¹æ¯”
3. **å‘Šè­¦é˜ˆå€¼**: å½“ Volume Score 2 è¶…è¿‡/ä½äºé˜ˆå€¼æ—¶é«˜äº®æ˜¾ç¤º
4. **å¯¼å‡ºåŠŸèƒ½**: æ”¯æŒå¯¼å‡ºå›¾è¡¨æ•°æ®ä¸º CSV

## ä¿®æ”¹æ—¥æœŸ

2025-10-23
