# Rule3 Tier Bypass Strategy

## æ¦‚è¿°

`rule3_tier_bypass.js` æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ WS Rule3 ç­–ç•¥æ’ä»¶ï¼Œä¸“æ³¨äºåŸºäº**å¸‚å€¼åŒºé—´**ä¸**5åˆ†é’Ÿæˆäº¤é¢**çš„æ¡£ä½åŒ¹é…é€»è¾‘ã€‚

- **æ ¸å¿ƒåŠŸèƒ½**: å½“ symbol çš„å¸‚å€¼ä¸æœ€è¿‘5åˆ†é’Ÿæˆäº¤é¢å‘½ä¸­ä»»æ„é…ç½®æ¡£ä½æ—¶ï¼Œç«‹å³å‘é€å‘Šè­¦ï¼ˆæ— éœ€å‡é‡æ£€æŸ¥ï¼‰ã€‚
- **è¾“å‡ºæ ¼å¼**: ä¸é»˜è®¤ç­–ç•¥ä¿æŒä¸€è‡´ï¼ŒåŒ…å«å¸‚å€¼ã€å€æ•°ã€ä»·æ ¼å˜åŠ¨ã€é€Ÿåº¦æŒ‡æ ‡ã€å¸‚åœºçŠ¶æ€ç­‰ã€‚
- **ç‹¬ç«‹æ€§**: å¯å•ç‹¬ä½¿ç”¨æˆ–ä¸å…¶ä»–ç­–ç•¥å¹¶è¡ŒåŠ è½½ã€‚

---

## é…ç½®ç¤ºä¾‹

åœ¨ `config.json` ä¸­é…ç½®ï¼š

```json
{
  "rule3ws": {
    "windowMinutes": 5,
    "turnoverUsdThreshold": 5000000,
    "cooldownSec": 1800,
    "marketCapMaxUsd": 500000000,
    "wsStrategies": [
      "./strategies/rule3_tier_bypass.js"
    ],
    "tierBypassStrategy": {
      "tiers": [
        {
          "marketCapLtUsd": 50000000,
          "vol5mGteUsd": 350000
        },
        {
          "marketCapGteUsd": 50000000,
          "vol5mGteUsd": 500000
        },
        {
          "marketCapGteUsd": 20000000,
          "marketCapLtUsd": 80000000,
          "vol5mGteUsd": 400000
        }
      ],
      "enableMarketState": true,
      "volumeThresholdRatio": 0.7,
      "defaultMarketCapUsd": 30000000
    }
  }
}
```

---

## é…ç½®å­—æ®µè¯´æ˜

### `tierBypassStrategy.tiers` (å¿…éœ€)

æ¡£ä½æ•°ç»„ï¼Œæ¯ä¸ªæ¡£ä½åŒ…å«ï¼š

- **`marketCapLtUsd`** (å¯é€‰): å¸‚å€¼ä¸Šé™ï¼ˆä¸å«ï¼‰ï¼Œå•ä½ USD
- **`marketCapGteUsd`** (å¯é€‰): å¸‚å€¼ä¸‹é™ï¼ˆå«ï¼‰ï¼Œå•ä½ USD
- **`vol5mGteUsd`** (å¿…éœ€): æœ€è¿‘5åˆ†é’Ÿæˆäº¤é¢ä¸‹é™ï¼ˆå«ï¼‰ï¼Œå•ä½ USD

**åŒ¹é…è§„åˆ™**:
- åŒæ—¶æä¾› `marketCapGteUsd` å’Œ `marketCapLtUsd` æ—¶ï¼Œè¦æ±‚å¸‚å€¼åœ¨åŒºé—´ `[marketCapGteUsd, marketCapLtUsd)` å†…ã€‚
- ä»…æä¾›ä¸€ä¾§è¾¹ç•Œæ—¶ï¼Œæ‰§è¡Œå•è¾¹åˆ¤æ–­ã€‚
- å¸‚å€¼æ¡ä»¶ **AND** 5mæˆäº¤é¢æ¡ä»¶åŒæ—¶æ»¡è¶³æ—¶ï¼Œæ¡£ä½å‘½ä¸­ã€‚

### `tierBypassStrategy.enableMarketState` (å¯é€‰ï¼Œé»˜è®¤ true)

æ˜¯å¦è®¡ç®—å¹¶é™„åŠ å¸‚åœºçŠ¶æ€ï¼ˆ`total_score`ã€`state`ã€`state_text`ï¼‰åˆ°å‘Šè­¦ payloadã€‚

### `tierBypassStrategy.volumeThresholdRatio` (å¯é€‰ï¼Œé»˜è®¤ 0.7)

ç”¨äºè®¡ç®—"é€Ÿåº¦"æŒ‡æ ‡çš„é˜ˆå€¼æ¯”ä¾‹ï¼šä»æœ€æ–°Kçº¿å¾€å›ç´¯è®¡ï¼Œè¾¾åˆ° `ratio * vol5m` æ‰€éœ€çš„Kçº¿æ•°é‡ã€‚

### `tierBypassStrategy.defaultMarketCapUsd` (å¯é€‰)

é»˜è®¤å¸‚å€¼ï¼ˆUSDï¼‰ã€‚å½“æ— æ³•ä»ä¾›ç»™æ•°æ®è®¡ç®—å‡ºå®é™…å¸‚å€¼æ—¶ï¼Œä½¿ç”¨æ­¤é»˜è®¤å€¼è¿›è¡Œæ¡£ä½åŒ¹é…ã€‚

- è‹¥æœªé…ç½®ä¸”æ— æ³•è·å–å¸‚å€¼ï¼Œè¯¥ symbol å°†è·³è¿‡æ¡£ä½æ£€æŸ¥ã€‚
- è‹¥é…ç½®äº†é»˜è®¤å¸‚å€¼ï¼Œå‘Šè­¦æ–‡æœ¬ä¸­ä¼šæ ‡æ³¨"(é»˜è®¤)"ï¼Œä¸” payload ä¸­ `using_default_market_cap` å­—æ®µä¸º `true`ã€‚

**ä½¿ç”¨åœºæ™¯**: é’ˆå¯¹æ–°ä¸Šçº¿æˆ–ä¾›ç»™æ•°æ®æœªåŒæ­¥çš„å¸ç§ï¼Œå¯è®¾ç½®ä¸€ä¸ªåˆç†çš„é»˜è®¤å¸‚å€¼ï¼ˆå¦‚ 30M USDï¼‰ä»¥é¿å…æ¼æŠ¥ã€‚

---

## å‘Šè­¦è¾“å‡º

### æ–‡æœ¬æ ¼å¼

```
ğŸ”¥ğŸ”¥ [SYMBOL](é“¾æ¥) ğŸ“ˆ
åŸå› : å¸‚å€¼$XX.XXMä¸”5mæˆäº¤é¢$YY.YYMï¼Œå‘½ä¸­ç¬¬Næ¡£
æˆäº¤é‡(USD): $ZZ.ZZM
å¸‚å€¼: $AA.AAM
å€æ•°: X.XX
ä»·æ ¼: $P1 â†’ $P2 (+X.XX%) ğŸ“ˆ
æ¡£ä½: ç¬¬Næ¡£ (5mé‡=$YY.YYM)
é€Ÿåº¦: æœ€è¿‘Xæ ¹1mè¾¾åˆ°é˜ˆå€¼0.7
ä»·æ ¼å˜åŠ¨: 0.XXX
```

**æ³¨**: è‹¥ä½¿ç”¨é»˜è®¤å¸‚å€¼ï¼ŒåŸå› è¡Œä¼šæ˜¾ç¤ºä¸ºï¼š`å¸‚å€¼$XX.XXM(é»˜è®¤)ä¸”5mæˆäº¤é¢$YY.YYMï¼Œå‘½ä¸­ç¬¬Næ¡£`

### Webhook Payload

ç»“æ„åŒ– JSONï¼ŒåŒ…å«ï¼š
- `strategy`: `"tier_bypass"`
- `metrics`:
  - `sumTurnover`, `marketCap`, `ratio`, `deltaPct`
  - `total_score`, `state`, `state_text` (è‹¥å¯ç”¨å¸‚åœºçŠ¶æ€)
  - `half_bars_to_half_threshold`, `price_change_pct_from_earliest_open`
  - `tier_index`: å‘½ä¸­çš„æ¡£ä½ç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰
  - `vol_5m`: æœ€è¿‘5åˆ†é’Ÿæˆäº¤é¢
  - `using_default_market_cap`: å¸ƒå°”å€¼ï¼Œæ˜¯å¦ä½¿ç”¨äº†é»˜è®¤å¸‚å€¼

---

## ä¸é»˜è®¤ç­–ç•¥çš„åŒºåˆ«

| ç‰¹æ€§ | `rule3_default.js` | `rule3_tier_bypass.js` |
|------|-------------------|------------------------|
| **è§¦å‘æ¡ä»¶** | æˆäº¤é¢è¾¾é˜ˆå€¼ + å¸‚å€¼è¿‡æ»¤ + å‡é‡æ£€æŸ¥ | æˆäº¤é¢è¾¾é˜ˆå€¼ + æ¡£ä½åŒ¹é…ï¼ˆå¸‚å€¼åŒºé—´ + 5mé‡ï¼‰ |
| **å‡é‡æ£€æŸ¥** | å¯é€‰å¯ç”¨ï¼Œé€šè¿‡ REST æ‹‰å– K çº¿æ ¡éªŒ | æ— å‡é‡æ£€æŸ¥ï¼Œæ¡£ä½å‘½ä¸­å³å‘é€ |
| **å‰ç¼€ Emoji** | â€¼ï¸â€¼ï¸ | ğŸ”¥ğŸ”¥ |
| **å†·å´ key** | `ws_rule3_...` | `tier_bypass_...` |
| **é€‚ç”¨åœºæ™¯** | é€šç”¨è§„åˆ™3ç›‘æ§ | é’ˆå¯¹ç‰¹å®šå¸‚å€¼ä¸5mé‡ç»„åˆçš„å¿«é€Ÿå“åº” |

---

## ä½¿ç”¨å»ºè®®

1. **å•ç‹¬ä½¿ç”¨**: é€‚åˆåªå…³æ³¨æ¡£ä½åŒ¹é…çš„åœºæ™¯ï¼Œé…ç½® `wsStrategies: ["./strategies/rule3_tier_bypass.js"]`ã€‚
2. **å¹¶è¡Œä½¿ç”¨**: å¯ä¸é»˜è®¤ç­–ç•¥åŒæ—¶åŠ è½½ï¼Œåˆ†åˆ«è§¦å‘ä¸åŒç±»å‹çš„å‘Šè­¦ï¼š
   ```json
   "wsStrategies": [
     "./strategies/rule3_default.js",
     "./strategies/rule3_tier_bypass.js"
   ]
   ```
   - é»˜è®¤ç­–ç•¥å¤„ç†å¸¸è§„æˆäº¤é¢å‘Šè­¦ï¼ˆå«å‡é‡æ ¡éªŒï¼‰ã€‚
   - Tier bypass ç­–ç•¥å¤„ç†æ¡£ä½åŒ¹é…çš„å¿«é€Ÿå‘Šè­¦ï¼ˆæ— å‡é‡æ ¡éªŒï¼‰ã€‚
   - ä¸¤è€…å†·å´ key ä¸åŒï¼Œäº’ä¸å¹²æ‰°ã€‚

3. **æ¡£ä½è°ƒæ•´**: æ ¹æ®å¸‚åœºæƒ…å†µåŠ¨æ€è°ƒæ•´ `tiers` é…ç½®ï¼Œæ— éœ€ä¿®æ”¹ä»£ç ã€‚

---

## æ—¥å¿—è¾“å‡º

### INFO çº§åˆ«ï¼ˆæ­£å¸¸è¿è¡Œæ—¶å¯è§ï¼‰

- **é€šè¿‡æ‰€æœ‰æ£€æŸ¥ï¼Œå‡†å¤‡å‘é€å‘Šè­¦**: 
  ```
  logger.info({ symbol, marketCap, usingDefault, vol5m, tierIndex, tier }, 'tier_bypassç­–ç•¥ï¼šå‘½ä¸­æ¡£ä½å¹¶é€šè¿‡å†·å´æ£€æŸ¥ï¼Œå‡†å¤‡å‘é€å‘Šè­¦')
  ```

### DEBUG çº§åˆ«ï¼ˆéœ€è®¾ç½® LOG_LEVEL=debug æ‰å¯è§ï¼‰

- **å‘½ä¸­æ¡£ä½ä½†åœ¨å†·å´æœŸ**:
  ```
  logger.debug({ symbol, marketCap, vol5m, tierIndex, remainingSec }, 'tier_bypassç­–ç•¥ï¼šå‘½ä¸­æ¡£ä½ä½†æœ¬åœ°å†·å´ä¸­ï¼Œè·³è¿‡')
  logger.debug({ symbol, marketCap, vol5m, tierIndex, remainingSec }, 'tier_bypassç­–ç•¥ï¼šå‘½ä¸­æ¡£ä½ä½†æ•°æ®åº“å†·å´ä¸­ï¼Œè·³è¿‡')
  ```
- **æœªå‘½ä¸­ä»»ä½•æ¡£ä½**: 
  ```
  logger.debug({ symbol, marketCap, vol5m, tiers }, 'tier_bypassç­–ç•¥ï¼šæœªåŒ¹é…ä»»ä½•æ¡£ä½ï¼Œè·³è¿‡')
  ```
- **ç¼ºå°‘å¿…è¦æ•°æ®**: 
  ```
  logger.debug({ symbol }, 'tier_bypassç­–ç•¥ï¼šç¼ºå°‘å¯ç”¨å¸‚å€¼/çª—å£è¯»å–å™¨ï¼Œè·³è¿‡')
  ```

**ä¼˜åŒ–è¯´æ˜**: å‘½ä¸­æ¡£ä½ä½†åœ¨å†·å´æœŸçš„æ—¥å¿—å·²é™çº§ä¸º `debug`ï¼Œé¿å…åœ¨æ­£å¸¸è¿è¡Œæ—¶äº§ç”Ÿå¤§é‡é‡å¤æ—¥å¿—ã€‚åªæœ‰çœŸæ­£å‘é€å‘Šè­¦æ—¶æ‰è¾“å‡º `info` çº§åˆ«æ—¥å¿—ã€‚

---

## ç¤ºä¾‹åœºæ™¯

### åœºæ™¯1ï¼šå°å¸‚å€¼å¿«é€Ÿæ‹‰å‡

- å¸‚å€¼ < 50Mï¼Œ5åˆ†é’Ÿé‡ > 350K â†’ ç«‹å³å‘Šè­¦ï¼Œæ— éœ€ç­‰å¾…å‡é‡æ ¡éªŒã€‚

### åœºæ™¯2ï¼šä¸­ç­‰å¸‚å€¼å¼‚å¸¸æ”¾é‡

- å¸‚å€¼åœ¨ [20M, 80M)ï¼Œ5åˆ†é’Ÿé‡ > 400K â†’ å¿«é€Ÿå“åº”ã€‚

### åœºæ™¯3ï¼šå¤§å¸‚å€¼ç¨³å®šç›‘æ§

- å¸‚å€¼ â‰¥ 50Mï¼Œ5åˆ†é’Ÿé‡ > 500K â†’ æ¡£ä½å‘½ä¸­ã€‚

---

## æ‰©å±•æ€§

- **æ–°å¢æ¡£ä½**: åœ¨ `tiers` æ•°ç»„ä¸­è¿½åŠ æ–°å¯¹è±¡å³å¯ã€‚
- **è‡ªå®šä¹‰æ–‡æœ¬**: ä¿®æ”¹ `buildStrategyText()` å‡½æ•°è°ƒæ•´è¾“å‡ºæ ¼å¼ã€‚
- **å…¶ä»–æŒ‡æ ‡**: åœ¨ `helpers.notify()` çš„ `extras` å‚æ•°ä¸­æ·»åŠ è‡ªå®šä¹‰å­—æ®µã€‚

---

## æ³¨æ„äº‹é¡¹

- ç¡®ä¿ `config.rule3ws.tierBypassStrategy.tiers` è‡³å°‘åŒ…å«ä¸€ä¸ªæ¡£ä½ï¼Œå¦åˆ™ç­–ç•¥è·³è¿‡æ‰€æœ‰ symbolã€‚
- æ¡£ä½åŒ¹é…ä¼˜å…ˆçº§æŒ‰æ•°ç»„é¡ºåºï¼Œå‘½ä¸­ç¬¬ä¸€ä¸ªå³åœæ­¢ã€‚
- è‹¥éœ€åŒæ—¶ä½¿ç”¨é»˜è®¤ç­–ç•¥ä¸ tier bypass ç­–ç•¥ï¼Œå»ºè®®åœ¨é»˜è®¤ç­–ç•¥ä¸­ç¦ç”¨æˆ–ç§»é™¤ `bypassAvgVolumeTiers` é…ç½®ï¼Œé¿å…é€»è¾‘é‡å¤ã€‚
